<!DOCTYPE html>
<html lang="fa">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
    <title>WebAR â€” Photo Frame with Video (MindAR)</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.7/dist/mindar-image-aframe.prod.js"></script>
    <style>
      html, body { margin:0; padding:0; overflow:hidden; height:100%; background:#000; }
      .ui {
        position: fixed; inset: 0; pointer-events: none;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      }
      .topbar {
        position: absolute; top: 12px; left: 12px; right: 12px;
        display:flex; gap:8px; align-items:center; justify-content:space-between;
        pointer-events: none;
      }
      .pill {
        pointer-events: auto; border: none; border-radius: 999px; padding: 10px 14px;
        background: rgba(255,255,255,0.9); font-weight:600; box-shadow: 0 4px 16px rgba(0,0,0,.25);
      }
      .hint {
        pointer-events:none; color:#fff; background: rgba(10,10,10,.35); padding:8px 12px; border-radius:12px;
        backdrop-filter: blur(6px);
      }
      .footer {
        position:absolute; bottom: 14px; left: 50%; transform: translateX(-50%);
        color:#fff; font-size: 14px; background: rgba(10,10,10,.35); padding:8px 12px; border-radius:12px;
      }
      @media (prefers-color-scheme: light) {
        .pill { background: rgba(0,0,0,0.85); color:#fff; }
        .hint, .footer { background: rgba(255,255,255,.35); color:#000; }
      }
    </style>
  </head>
  <body>
    <!-- SCENE -->
    <a-scene
      mindar-image="imageTargetSrc: ./targets.mind;"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: true">
      
      <a-assets>
        <!-- IMPORTANT: replace video.mp4 with your real mp4; keep playsinline for iOS -->
        <video id="video1" src="./video.mp4" preload="auto" playsinline webkit-playsinline></video>
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <!-- Target #0 from targets.mind -->
      <a-entity id="target0" mindar-image-target="targetIndex: 0">
        <!-- Size 1x0.56 ~ 16:9. Adjust to match your frame's aspect -->
        <a-video id="plane" src="#video1" width="1" height="0.56" position="0 0 0"></a-video>
      </a-entity>
    </a-scene>

    <!-- UI -->
    <div class="ui" dir="rtl">
      <div class="topbar">
        <button id="btnSound" class="pill">ğŸ”Š ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† ØµØ¯Ø§</button>
        <div class="hint">Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø±Ø§ Ø¨Ù‡ Ø¹Ú©Ø³ Ù‚Ø§Ø¨ Ø¨Ú¯ÛŒØ±ÛŒØ¯</div>
      </div>
      <div class="footer">Ø§Ú¯Ø± ØªØµÙˆÛŒØ± Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯ ÙˆÙ„ÛŒ ØµØ¯Ø§ Ù†Ø¯Ø§Ø´ØªØŒ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ù„Ø§ Ø¨Ø²Ù†ÛŒØ¯</div>
    </div>

    <script>
      const video = document.getElementById('video1');
      const btn = document.getElementById('btnSound');
      const target = document.getElementById('target0');

      // When target appears, start playback muted (mobile safe)
      target.addEventListener('targetFound', () => {
        try { video.muted = true; video.play(); } catch(e) {}
      });
      // Pause when target lost
      target.addEventListener('targetLost', () => {
        try { video.pause(); } catch(e) {}
      });

      // User gesture -> enable sound
      btn.addEventListener('click', async () => {
        try {
          video.muted = false;
          await video.play();
          btn.style.display = 'none';
        } catch (e) {
          alert('Ù…Ø±ÙˆØ±Ú¯Ø± Ø§Ø¬Ø§Ø²Ù‡ Ù¾Ø®Ø´ ØµØ¯Ø§ Ø±Ø§ Ù†Ø¯Ø§Ø¯. Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
        }
      });
    </script>
  </body>
</html>
